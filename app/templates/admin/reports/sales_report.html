{% extends "base.html" %}

{% block title %}销售统计报表 - 在线购物网站{% endblock %}

{% block content %}
<h2 class="mb-4">销售统计报表</h2>

<!-- 时间范围筛选 -->
<div class="row mb-4">
    <div class="col-md-4">
        <form method="GET" action="{{ url_for('admin.sales_report') }}" class="d-inline-flex align-items-center gap-2">
            <label class="form-label mb-0">统计近</label>
            <select class="form-select form-select-sm w-auto" id="days" name="days" onchange="this.form.submit()">
                <option value="7" {% if days == 7 %}selected{% endif %}>7天</option>
                <option value="30" {% if days == 30 %}selected{% endif %}>30天</option>
                <option value="90" {% if days == 90 %}selected{% endif %}>90天</option>
            </select>
            <label class="form-label mb-0">的数据</label>
        </form>
    </div>
</div>

<!-- 统计卡片 -->
<div class="row gap-4 mb-5">
    <div class="col-md-4">
        <div class="card bg-primary text-white h-100 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">总销售额</h5>
                <h2 class="display-4">¥{{ "%.2f"|format(total_sales or 0.0) }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-success text-white h-100 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">总订单数</h5>
                <h2 class="display-4">{{ total_orders or 0 }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-danger text-white h-100 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">平均订单金额</h5>
                <h2 class="display-4">¥{{ "%.2f"|format(avg_order_amount or 0.0) }}</h2>
            </div>
        </div>
    </div>
</div>

<!-- 热销商品TOP10 -->
<div class="table-container">
    <h5 class="mb-3">销量TOP10商品</h5>
    <table class="table table-hover table-striped">
        <thead class="table-light">
            <tr>
                <th>排名</th>
                <th>商品名称</th>
                <th>累计销量</th>
                <th>累计销售额</th>
            </tr>
        </thead>
        <tbody>
            {% for product, total_quantity, total_sales in top_products %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ product.name }}</td>
                <td>{{ total_quantity or 0 }}</td>
                <td>¥{{ "%.2f"|format(total_sales or 0.0) }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" class="text-center text-muted">暂无销售数据可供展示</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}